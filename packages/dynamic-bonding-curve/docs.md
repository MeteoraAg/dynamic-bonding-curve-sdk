# Dynamic Bonding Curve SDK: Function Documentation

## Table of Contents

- [Partner Functions](#partner-functions)

    - [createConfig](#createConfig)
    - [buildCurveAndCreateConfig](#buildCurveAndCreateConfig)
    - [buildCurveAndCreateConfigByMarketCap](#buildCurveAndCreateConfigByMarketCap)
    - [createPartnerMetadata](#createPartnerMetadata)
    - [claimTradingFee](#claimTradingFee)
    - [partnerWithdrawSurplus](#partnerWithdrawSurplus)

- [Pool Functions](#pool-functions)

    - [createPool](#createPool)
    - [swap](#swap)
    - [swapQuote](#swapQuote)

- [Migration Functions](#migration-functions)

    - [createLocker](#createLocker)
    - [withdrawLeftover](#withdrawLeftover)
    - [createDammV1MigrationMetadata](#createDammV1MigrationMetadata)
    - [migrateToDammV1](#migrateToDammV1)
    - [lockDammV1LpToken](#lockDammV1LpToken)
    - [claimDammV1LpToken](#claimDammV1LpToken)
    - [createDammV2MigrationMetadata](#createDammV2MigrationMetadata)
    - [migrateToDammV2](#migrateToDammV2)

- [Creator Functions](#creator-functions)

    - [createPoolMetadata](#createPoolMetadata)
    - [claimCreatorTradingFee](#claimCreatorTradingFee)
    - [creatorWithdrawSurplus](#creatorWithdrawSurplus)

- [Helper Functions](#helper-functions)

    - [getPoolConfig](#getPoolConfig)
    - [getPoolConfigs](#getPoolConfigs)
    - [getPoolConfigsByOwner](#getPoolConfigsByOwner)
    - [getPool](#getPool)
    - [getPools](#getPools)
    - [getPoolMigrationQuoteThreshold](#getPoolMigrationQuoteThreshold)
    - [getPoolMetadata](#getPoolMetadata)
    - [getPartnerMetadata](#getPartnerMetadata)
    - [getDammV1MigrationMetadata](#getDammV1MigrationMetadata)
    - [getLockedLpTokenAmount](#getLockedLpTokenAmount)
    - [getCurveProgress](#getCurveProgress)
    - [getPoolAddress](#getPoolAddress)

---

## Partner Functions

### createConfig

Creates a new configuration key that will dictate the behavior of all pools created with this key.

#### Function

```typescript
async createConfig(createConfigParam: CreateConfigParam): Promise<Transaction>
```

#### Parameters

```typescript
interface CreateConfigParam {
    payer: PublicKey                            // The wallet paying for the transaction
    config: PublicKey                           // The config account address (generated by the partner)
    feeClaimer: PublicKey                       // The wallet that will be able to claim the fee
    leftoverReceiver: PublicKey                 // The wallet that will receive the bonding curve leftover
    quoteMint: PublicKey                        // The quote mint address
    poolFees: {                                 // The pool fees
        baseFee: {
            cliffFeeNumerator: BN               // Initial fee numerator (base fee)
            numberOfPeriod: number              // The number of reduction periods
            reductionFactor: BN                 // How much fee reduces in each period
            periodFrequency: BN                 // How often fees change
            feeSchedulerMode: number            // 0: Linear, 1: Exponential
        }
        dynamicFee: {                           // Optional dynamic fee
            binStep: number                     // u16 value representing the bin step in bps
            binStepU128: BN                     // u128 value for a more accurate bin step
            filterPeriod: number                // Minimum time that must pass between fee updates
            decayPeriod: number                 // Period after the volatility starts decaying (must be > filterPeriod)
            reductionFactor: number             // Controls how quickly volatility decys over time
            variableFeeControl: number          // Multiplier that determines how much volatility affects fees
            maxVolatilityAccumulator: number    // Caps the maximum volatility that can be accumulated
        } | null
    }
    activationType: number                      // 0: Slot, 1: Timestamp
    collectFeeMode: number                      // 0: Only Quote, 1: Both
    migrationOption: number                     // 0: DAMM V1, 1: DAMM v2
    tokenType: number                           // 0: SPL, 1: Token2022
    tokenDecimal: number                        // The number of decimals for the token
    migrationQuoteThreshold: BN                 // The quote threshold for migration
    partnerLpPercentage: number                 // The percentage of the pool that will be allocated to the partner (0-100)
    creatorLpPercentage: number                 // The percentage of the pool that will be allocated to the creator (0-100)
    partnerLockedLpPercentage: number           // The percentage of the pool that will be allocated to the partner locked (0-100)
    creatorLockedLpPercentage: number           // The percentage of the pool that will be allocated to the creator locked (0-100)
    sqrtStartPrice: BN                          // The starting price of the pool
    lockedVesting: {                            // Optional locked vesting (BN (0) for all fields for no vesting)
        amountPerPeriod: BN                     // The amount of tokens that will be vested per period
        cliffDurationFromMigrationTime: BN      // The duration of the cliff period
        frequency: BN                           // The frequency of the vesting
        numberOfPeriod: BN                      // The number of periods
        cliffUnlockAmount: BN                   // The amount of tokens that will be unlocked at the cliff
    }
    migrationFeeOption: number                  // 0: Fixed 25bps, 1: Fixed 30bps, 2: Fixed 100bps, 3: Fixed 200bps, 4: Fixed 400bps, 5: Fixed 600bps
    tokenSupply: {                              // Optional token supply 
        preMigrationTokenSupply: BN             // The token supply before migration
        postMigrationTokenSupply: BN            // The token supply after migration
    } | null
    creatorTradingFeePercentage: number         // The percentage of the trading fee that will be allocated to the creator
    padding0: []                                
    padding1: []                                
    curve: {                                    // The curve of the pool
        sqrtPrice: BN                           // The square root of the curve point price
        liquidity: BN                           // The liquidity of the curve point
    }[]
}
```

#### Returns

A transaction that can be partially signed and sent to the network.

#### Example

```typescript
const transaction = await client.partner.createConfig({
    payer: wallet.publicKey,
    config: config.publicKey,
    feeClaimer: wallet.publicKey,
    leftoverReceiver: wallet.publicKey,
    quoteMint: new PublicKey('So11111111111111111111111111111111111111112'),
    poolFees: {
        baseFee: {
            cliffFeeNumerator: new BN('2500000'),
            numberOfPeriod: 0,
            reductionFactor: new BN('0'),
            periodFrequency: new BN('0'),
            feeSchedulerMode: FeeSchedulerMode.Linear,
        },
        dynamicFee: {
            binStep: 1,
            binStepU128: new BN('1844674407370955'),
            filterPeriod: 10,
            decayPeriod: 120,
            reductionFactor: 1000,
            variableFeeControl: 100000,
            maxVolatilityAccumulator: 100000,
        },
    },
    activationType: 0,
    collectFeeMode: 0,
    migrationOption: 0
    tokenType: 0,
    tokenDecimal: 9,
    migrationQuoteThreshold: new BN('1000000000'),
    partnerLpPercentage: 25,
    creatorLpPercentage: 25,
    partnerLockedLpPercentage: 25,
    creatorLockedLpPercentage: 25,
    sqrtStartPrice: new BN('58333726687135158'),
    lockedVesting: {
        amountPerPeriod: new BN('0'),
        cliffDurationFromMigrationTime: new BN('0'),
        frequency: new BN('0'),
        numberOfPeriod: new BN('0'),
        cliffUnlockAmount: new BN('0'),
    },
    migrationFeeOption: 0,
    tokenSupply: {
        preMigrationTokenSupply: new BN('10000000000000000000'),
        postMigrationTokenSupply: new BN('10000000000000000000'),
    },
    creatorTradingFeePercentage: 0,
    padding0: [],
    padding1: [],
    curve: [
        {
            sqrtPrice: new BN('233334906748540631'),
            liquidity: new BN('622226417996106429201027821619672729'),
        },
        {
            sqrtPrice: new BN('79226673521066979257578248091'),
            liquidity: new BN('1'),
        },
    ],
})
```

#### Notes
## Validating Configuration Parameters

When creating a new configuration for a dynamic bonding curve, several validations are performed to ensure the parameters are valid:

##### Pool Fees
- Pool fees are required and must be valid
- Base fee must have a positive cliff fee numerator

##### Fee Mode
- Collect fee mode must be either `OnlyQuote` (0) or `Both` (1)

##### Migration and Token Type
- For MeteoraDamm migration (option 0), token type must be SPL (0)

##### Activation Type
- Must be either Slot (0) or Timestamp (1)

##### Migration Fee
- Must be a valid option: FixedBps25 (0), FixedBps30 (1), FixedBps100 (2), FixedBps200 (3), etc.

#####Token Decimals
- Must be between 6 and 9

##### LP Percentages
- The sum of partner LP, creator LP, partner locked LP, and creator locked LP percentages must equal 100

##### Migration Quote Threshold
- Must be greater than 0

##### Price
- Square root start price must be within valid range (MIN_SQRT_PRICE to MAX_SQRT_PRICE)

##### Curve
- Must have at least one point and not exceed MAX_CURVE_POINT
- First curve point must have sqrt price greater than start price and positive liquidity
- Curve points must be in ascending order by sqrt price
- All points must have positive liquidity
- Last point's sqrt price must not exceed MAX_SQRT_PRICE

##### Locked Vesting
- If not default (all zeros), must have valid frequency and total amount greater than 0

##### Token Supply
- Must be valid in relation to swap base amount, migration base amount, and locked vesting
- Post-migration supply must not exceed pre-migration supply
- Total required tokens (swap + migration + vesting) must not exceed pre-migration supply
- Leftover receiver must be a valid PublicKey (not default/zero address)

---

### buildCurveAndCreateConfig

Builds a new constant product config with customisable parameters based on percentage of supply on migration and migration quote threshold. This creates a new configuration key that will dictate the behavior of all pools created with this key.

#### Function

```typescript
async buildCurveAndCreateConfig(buildCurveAndCreateConfigParam: BuildCurveAndCreateConfigParam): Promise<Transaction>
```

#### Parameters

```typescript
interface BuildCurveAndCreateConfigParam {
    buildCurveParam: {
        totalTokenSupply: number                // The total token supply
        percentageSupplyOnMigration: number     // The percentage of the supply that will be migrated
        migrationQuoteThreshold: number         // The quote threshold for migration
        migrationOption: number                 // 0: DAMM V1, 1: DAMM v2
        tokenBaseDecimal: number                // The number of decimals for the base token
        tokenQuoteDecimal: number               // The number of decimals for the quote token
        lockedVesting: {                        // Optional locked vesting (BN (0) for all fields for no vesting)
            amountPerPeriod: BN                 // The amount of tokens that will be vested per period
            cliffDurationFromMigrationTime: BN  // The duration of the cliff period
            frequency: BN                       // The frequency of the vesting
            numberOfPeriod: BN                  // The number of periods
            cliffUnlockAmount: BN               // The amount of tokens that will be unlocked at the cliff
        }
        feeSchedulerParam: {                    // Optional fee scheduler (BN (0) for all fields for no fee scheduler)
            numberOfPeriod: number              // The number of periods
            reductionFactor: number             // The reduction factor
            periodFrequency: number             // The frequency of the fee reduction
            feeSchedulerMode: number            // 0: Linear, 1: Exponential
        }
        baseFeeBps: number                      // The base fee in bps
        dynamicFeeEnabled: boolean              // Whether dynamic fee is enabled (true: enabled, false: disabled)
        activationType: number                  // 0: Slot, 1: Timestamp
        collectFeeMode: number                  // 0: Only Quote, 1: Both
        migrationFeeOption: number              // 0: Fixed 25bps, 1: Fixed 30bps, 2: Fixed 100bps, 3: Fixed 200bps, 4: Fixed 400bps, 5: Fixed 600bps
        tokenType: number                       // 0: SPL, 1: Token2022
        partnerLpPercentage: number             // The percentage of the pool that will be allocated to the partner
        creatorLpPercentage: number             // The percentage of the pool that will be allocated to the creator
        partnerLockedLpPercentage: number       // The percentage of the pool that will be allocated to the partner locked
        creatorLockedLpPercentage: number       // The percentage of the pool that will be allocated to the creator locked
        creatorTradingFeePercentage: number     // The percentage of the trading fee that will be allocated to the creator
    }
    feeClaimer: PublicKey                       // The wallet that will be able to claim the fee
    leftoverReceiver: PublicKey                 // The wallet that will receive the bonding curve leftover
    payer: PublicKey                            // The wallet that will pay for the transaction
    quoteMint: PublicKey                        // The quote mint address
    config: PublicKey                           // The config account address (generated by the partner)
}
```

#### Returns

A transaction that can be partially signed and sent to the network.

#### Example

```typescript
const transaction = await client.partner.buildCurveAndCreateConfig({
    buildCurveParam: {
        totalTokenSupply: 1000000000,
        percentageSupplyOnMigration: 3,
        migrationQuoteThreshold: 0.5,
        migrationOption: 0,
        tokenBaseDecimal: 9,
        tokenQuoteDecimal: 9,
        lockedVesting: {
            amountPerPeriod: new BN(1000000),
            cliffDurationFromMigrationTime: new BN(0),
            frequency: new BN(30 * 24 * 60 * 60),
            numberOfPeriod: new BN(12),
            cliffUnlockAmount: new BN(5000000),
        },
        feeSchedulerParam: {
            numberOfPeriod: 0,
            reductionFactor: 0,
            periodFrequency: 0,
            feeSchedulerMode: 0,
        },
        baseFeeBps: 100,
        dynamicFeeEnabled: true,
        activationType: 0,
        collectFeeMode: 0,
        migrationFeeOption: 0,
        tokenType: 0,
        partnerLpPercentage: 25,
        creatorLpPercentage: 25,
        partnerLockedLpPercentage: 25,
        creatorLockedLpPercentage: 25,
        creatorTradingFeePercentage: 0,
    },
    feeClaimer: wallet.publicKey,
    leftoverReceiver: wallet.publicKey,
    payer: wallet.publicKey,
    quoteMint: new PublicKey('So11111111111111111111111111111111111111112'),
    config: config.publicKey,
})
```

#### Notes

Same validation checks as [createConfig](#createConfig)

---

### buildCurveAndCreateConfigByMarketCap

Builds a new constant product config with customisable parameters based on market cap. This creates a new configuration key that will dictate the behavior of all pools created with this key.

#### Function

```typescript
async buildCurveAndCreateConfigByMarketCap(buildCurveAndCreateConfigByMarketCapParam: BuildCurveAndCreateConfigByMarketCapParam): Promise<Transaction>
```

#### Parameters

```typescript
interface BuildCurveAndCreateConfigByMarketCapParam {
    buildCurveByMarketCapParam: {
        totalTokenSupply: number                // The total token supply
        initialMarketCap: number                // The initial market cap
        migrationMarketCap: number              // The migration market cap
        migrationOption: number                 // 0: DAMM V1, 1: DAMM v2
        tokenBaseDecimal: number                // The number of decimals for the base token
        tokenQuoteDecimal: number               // The number of decimals for the quote token
        lockedVesting: {                        // Optional locked vesting (BN (0) for all fields for no vesting)
            amountPerPeriod: BN                 // The amount of tokens that will be vested per period
            cliffDurationFromMigrationTime: BN  // The duration of the cliff period
            frequency: BN                       // The frequency of the vesting
            numberOfPeriod: BN                  // The number of periods
            cliffUnlockAmount: BN               // The amount of tokens that will be unlocked at the cliff
        }
        feeSchedulerParam: {                    // Optional fee scheduler (BN (0) for all fields for no fee scheduler)
            numberOfPeriod: number              // The number of periods
            reductionFactor: number             // The reduction factor
            periodFrequency: number             // The frequency of the fee reduction
            feeSchedulerMode: number            // 0: Linear, 1: Exponential
        }
        baseFeeBps: number                      // The base fee in bps
        dynamicFeeEnabled: boolean              // Whether dynamic fee is enabled (true: enabled, false: disabled)
        activationType: number                  // 0: Slot, 1: Timestamp
        collectFeeMode: number                  // 0: Only Quote, 1: Both
        migrationFeeOption: number              // 0: Fixed 25bps, 1: Fixed 30bps, 2: Fixed 100bps, 3: Fixed 200bps, 4: Fixed 400bps, 5: Fixed 600bps
        tokenType: number                       // 0: SPL, 1: Token2022
        partnerLpPercentage: number             // The percentage of the pool that will be allocated to the partner
        creatorLpPercentage: number             // The percentage of the pool that will be allocated to the creator
        partnerLockedLpPercentage: number       // The percentage of the pool that will be allocated to the partner locked
        creatorLockedLpPercentage: number       // The percentage of the pool that will be allocated to the creator locked
        creatorTradingFeePercentage: number     // The percentage of the trading fee that will be allocated to the creator
    }
    feeClaimer: PublicKey                       // The wallet that will be able to claim the fee
    leftoverReceiver: PublicKey                 // The wallet that will receive the bonding curve leftover
    payer: PublicKey                            // The wallet that will pay for the transaction
    quoteMint: PublicKey                        // The quote mint address
    config: PublicKey                           // The config account address (generated by the partner)
}
```

#### Returns

A transaction that can be partially signed and sent to the network.

#### Example

```typescript
const transaction = await client.partner.buildCurveAndCreateConfigByMarketCap({
    buildCurveByMarketCapParam: {
        totalTokenSupply: 1000000000,
        initialMarketCap: 98.58,
        migrationMarketCap: 3187.61,
        migrationOption: 0,
        tokenBaseDecimal: 9,
        tokenQuoteDecimal: 9,
        lockedVesting: {
            amountPerPeriod: new BN(0),
            cliffDurationFromMigrationTime: new BN(0),
            frequency: new BN(0),
            numberOfPeriod: new BN(0),
            cliffUnlockAmount: new BN(0),
        },
        feeSchedulerParam: {
            numberOfPeriod: 0,
            reductionFactor: 0,
            periodFrequency: 0,
            feeSchedulerMode: 0,
        },
        baseFeeBps: 100,
        dynamicFeeEnabled: true,
        activationType: 0,
        collectFeeMode: 0,
        migrationFeeOption: 0,
        tokenType: TokenType.SPL,
        partnerLpPercentage: 25,
        creatorLpPercentage: 25,
        partnerLockedLpPercentage: 25,
        creatorLockedLpPercentage: 25,
        creatorTradingFeePercentage: 0,
    },
    feeClaimer: wallet.publicKey,
    leftoverReceiver: wallet.publicKey,
    payer: wallet.publicKey,
    quoteMint: new PublicKey('So11111111111111111111111111111111111111112'),
    config: config.publicKey,
})
```

#### Notes

Same validation checks as [createConfig](#createConfig)

---

### createPartnerMetadata

Creates a new partner metadata account.

#### Function

```typescript
async createPartnerMetadata(createPartnerMetadataParam: CreatePartnerMetadataParam): Promise<Transaction>
```

#### Parameters

```typescript
interface CreatePartnerMetadataParam {
    name: string                                // The name of the partner
    website: string                             // The website of the partner
    logo: string                                // The logo of the partner
    feeClaimer: PublicKey                       // The wallet that will be able to claim the fee
    payer: PublicKey                            // The wallet that will pay for the transaction
}
```

#### Returns

A transaction that can be partially signed and sent to the network.

#### Example

```typescript
const transaction = await client.partner.createPartnerMetadata({
    name: 'Meteora',
    website: 'https://meteora.ag',
    logo: 'https://launch.meteora.ag',
    feeClaimer: wallet.publicKey,
    payer: wallet.publicKey,
})
```

---

## Pool Functions

### createPool

Creates a new pool with the configuration key.

#### Function

```typescript
async createPool(createPoolParam: CreatePoolParam): Promise<Transaction>
```

#### Parameters

```typescript
interface CreatePoolParam {
    quoteMint: PublicKey
    baseMint: PublicKey
    config: PublicKey
    baseTokenType: number
    quoteTokenType: number
    name: string
    symbol: string
    uri: string
    payer: PublicKey
    poolCreator: PublicKey
}
```

#### Returns

A transaction that requires signatures from both the creator's wallet and the baseMint keypair before being submitted to the network.

#### Example

```typescript
const transaction = await client.pools.createPool({
    quoteMint: new PublicKey('So11111111111111111111111111111111111111112'),
    baseMint: new PublicKey('JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN'),
    config: config.publicKey,
    baseTokenType: 0,
    quoteTokenType: 0,
    name: 'Jupiter',
    symbol: 'JUP',
    uri: 'https://jup.ag',
    payer: wallet.publicKey,
    poolCreator: poolCreator.publicKey,
})
```

---

### swap

Swaps between base and quote or quote and base.

#### Function

```typescript
async swap(pool: PublicKey, swapParam: SwapParam): Promise<Transaction>
```

#### Parameters

```typescript
interface SwapParam {
    owner: PublicKey
    amountIn: BN
    minimumAmountOut: BN
    swapBaseForQuote: boolean
}
```

#### Returns

A transaction that can be signed and sent to the network.

#### Example

```typescript
const transaction = await client.pools.swap(poolAddress, {
    owner: wallet.publicKey,
    amountIn: new BN(1000000000),
    minimumAmountOut: new BN(0),
    swapBaseForQuote: false,
})
```

---

### swapQuote

Swaps between base and quote or quote and base.

#### Function

```typescript
swapQuote(swapQuoteParam: SwapQuoteParam): Promise<QuoteResult>
```

#### Parameters

```typescript
interface SwapQuoteParam {
    virtualPool: VirtualPool
    config: PoolConfig
    swapBaseForQuote: boolean
    amountIn: BN
    hasReferral: boolean
    currentPoint: BN
}
```

#### Returns

The quote result of the swap.

#### Example

```typescript
const quote = client.pools.swapQuote({
    virtualPool,
    swapBaseForQuote,
    amountIn,
    hasReferral,
    currentPoint,
})
```
